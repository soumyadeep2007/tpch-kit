                                                                                                                                  QUERY PLAN                                                                                                                                  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Finalize Aggregate  (cost=2877414.26..2877414.27 rows=1 width=32) (actual time=160091.061..160091.063 rows=1 loops=1)
   ->  Gather Motion 3:1  (slice1; segments: 3)  (cost=2877414.19..2877414.24 rows=3 width=32) (actual time=159924.982..160091.041 rows=3 loops=1)
         ->  Partial Aggregate  (cost=2877414.19..2877414.20 rows=1 width=32) (actual time=159922.955..159922.957 rows=1 loops=1)
               ->  Hash Join  (cost=1829768.67..2877170.17 rows=97610 width=8) (actual time=141147.816..159920.535 rows=5350 loops=1)
                     Hash Cond: (lineitem.l_partkey = part.p_partkey)
                     Join Filter: (lineitem.l_quantity < ((0.2 * avg(lineitem_1.l_quantity))))
                     Rows Removed by Join Filter: 54109
                     Extra Text: (seg0)   Hash chain length 1.0 avg, 3 max, using 5644 of 65536 buckets.
                     ->  Seq Scan on lineitem  (cost=0.00..886186.56 rows=59999456 width=17) (actual time=0.153..10597.302 rows=60003310 loops=1)
                     ->  Hash  (cost=1829402.63..1829402.63 rows=29283 width=40) (actual time=141142.546..141142.547 rows=5910 loops=1)
                           Buckets: 65536  Batches: 1  Memory Usage: 826kB
                           ->  Broadcast Motion 3:3  (slice2; segments: 3)  (cost=1778196.72..1829402.63 rows=29283 width=40) (actual time=130912.787..141140.698 rows=5910 loops=1)
                                 ->  Hash Join  (cost=1778196.72..1829012.18 rows=9761 width=40) (actual time=130007.688..141137.829 rows=2006 loops=1)
                                       Hash Cond: (lineitem_1.l_partkey = part.p_partkey)
                                       Extra Text: (seg0)   Hash chain length 1.0 avg, 2 max, using 1956 of 131072 buckets.
                                       ->  Finalize HashAggregate  (cost=1772703.91..1800243.01 rows=1835940 width=36) (actual time=129914.241..140620.091 rows=2001127 loops=1)
                                             Group Key: lineitem_1.l_partkey
                                             Planned Partitions: 8
                                             Extra Text: (seg0)   hash table(s): 1; 1999439 groups total in 80 batches, 46054864 spill partitions; disk usage: 372832KB; chain length 2.1 avg, 6 max; using 1999439 of 21233664 buckets; total 0 expansions.
 
                                             ->  Redistribute Motion 3:3  (slice3; segments: 3)  (cost=1479149.93..1731395.32 rows=5507811 width=36) (actual time=50971.140..123544.137 rows=6003137 loops=1)
                                                   Hash Key: lineitem_1.l_partkey
                                                   ->  Partial HashAggregate  (cost=1479149.93..1621239.10 rows=5507811 width=36) (actual time=51666.576..126553.761 rows=5999772 loops=1)
                                                         Group Key: lineitem_1.l_partkey
                                                         Planned Partitions: 32
                                                         Extra Text: (seg0)   hash table(s): 1; 5999772 groups total in 248 batches, 1901262040 spill partitions; disk usage: 2217408KB; chain length 2.0 avg, 5 max; using 5999772 of 130547712 buckets; total 0 expansions.
 
                                                         ->  Seq Scan on lineitem lineitem_1  (cost=0.00..886186.56 rows=59999456 width=9) (actual time=0.077..11311.589 rows=60003310 loops=1)
                                       ->  Hash  (cost=5359.89..5359.89 rows=10633 width=4) (actual time=79.639..79.641 rows=2006 loops=1)
                                             Buckets: 131072  Batches: 1  Memory Usage: 1095kB
                                             ->  Bitmap Heap Scan on part  (cost=103.33..5359.89 rows=10633 width=4) (actual time=21.086..78.622 rows=2006 loops=1)
                                                   Recheck Cond: ((p_container = 'SM BOX'::bpchar) AND (p_brand = 'Brand#53'::bpchar))
                                                   ->  Bitmap Index Scan on part_p_container_p_brand_p_partkey_idx  (cost=0.00..100.67 rows=2150 width=0) (actual time=20.730..20.730 rows=2006 loops=1)
                                                         Index Cond: ((p_container = 'SM BOX'::bpchar) AND (p_brand = 'Brand#53'::bpchar))
 Optimizer: Postgres-based planner
 Planning Time: 22.429 ms
   (slice0)    Executor memory: 18577K bytes.
   (slice1)    Executor memory: 877K bytes avg x 3 workers, 877K bytes max (seg0).  Work_mem: 826K bytes max.
 * (slice2)    Executor memory: 48246K bytes avg x 3 workers, 56446K bytes max (seg0).  Work_mem: 47377K bytes max, 1300497K bytes wanted.
 * (slice3)    Executor memory: 23762K bytes avg x 3 workers, 23762K bytes max (seg0).  Work_mem: 37905K bytes max, 2920465K bytes wanted.
 Memory used:  128000kB
 Memory wanted:  14603320kB
 Execution Time: 160116.601 ms
(43 rows)

