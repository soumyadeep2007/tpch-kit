                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=1280594.16..1280594.44 rows=20 width=201) (actual time=38934.836..38934.854 rows=20 loops=1)
   ->  Gather Motion 3:1  (slice1; segments: 3)  (cost=1280594.16..1280595.01 rows=60 width=201) (actual time=38934.834..38934.849 rows=20 loops=1)
         Merge Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount))))
         ->  Limit  (cost=1280594.16..1280594.21 rows=20 width=201) (actual time=38905.172..38927.617 rows=20 loops=1)
               ->  Sort  (cost=1280461.67..1281786.57 rows=529962 width=201) (actual time=38905.170..38905.175 rows=20 loops=1)
                     Sort Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount)))) DESC
                     Sort Method:  top-N heapsort  Memory: 101kB
                     Executor Memory: 177kB  Segments: 3  Max: 59kB (segment 0)
                     ->  HashAggregate  (cost=1259735.04..1266359.57 rows=529962 width=201) (actual time=36856.243..38673.239 rows=383465 loops=1)
                           Group Key: customer.c_custkey, customer.c_name, customer.c_acctbal, customer.c_phone, nation.n_name, customer.c_address, customer.c_comment
                           Planned Partitions: 8
                           Extra Text: (seg0)   hash table(s): 1; 382397 groups total in 8 batches, 7703896 spill partitions; disk usage: 194208KB; chain length 2.2 avg, 9 max; using 382397 of 1179648 buckets; total 0 expansions.
 
                           ->  Hash Join  (cost=1202895.88..1246485.99 rows=529962 width=181) (actual time=32183.895..34914.627 rows=1146024 loops=1)
                                 Hash Cond: (customer.c_nationkey = nation.n_nationkey)
                                 Extra Text: (seg2)   Hash chain length 1.0 avg, 1 max, using 25 of 65536 buckets.
                                 ->  Hash Join  (cost=1202894.15..1239769.64 rows=529962 width=159) (actual time=32183.647..34498.620 rows=1146024 loops=1)
                                       Hash Cond: (customer.c_custkey = orders.o_custkey)
                                       Extra Text: (seg2)   Initial batch 0:
 (seg2)     Wrote 20929K bytes to inner workfile.
 (seg2)     Wrote 133257K bytes to outer workfile.
 (seg2)   Overflow batch 1:
 (seg2)     Read 20929K bytes from inner workfile.
 (seg2)     Read 133257K bytes from outer workfile.
 (seg2)   Work file set: 1 files (0 compressed), max file size 21430272, min file size 32768, compression buffer size 0 bytes
 (seg2)   Hash chain length 5.7 avg, 41 max, using 201552 of 262144 buckets.
                                       ->  Seq Scan on customer  (cost=0.00..23888.00 rows=1500000 width=147) (actual time=0.133..333.977 rows=1501094 loops=1)
                                       ->  Hash  (cost=1196269.62..1196269.62 rows=529962 width=16) (actual time=32183.170..32183.170 rows=1146024 loops=1)
                                             Buckets: 131072 (originally 131072)  Batches: 2 (originally 1)  Memory Usage: 30852kB
                                             ->  Redistribute Motion 3:3  (slice2; segments: 3)  (cost=230222.51..1196269.62 rows=529962 width=16) (actual time=12798.873..31909.641 rows=1146024 loops=1)
                                                   Hash Key: orders.o_custkey
                                                   ->  Hash Join  (cost=230222.51..1185670.38 rows=529962 width=16) (actual time=12348.995..31558.247 rows=1145273 loops=1)
                                                         Hash Cond: (lineitem.l_orderkey = orders.o_orderkey)
                                                         Extra Text: (seg0)   Initial batch 0:
 (seg0)     Wrote 45317K bytes to inner workfile.
 (seg0)     Wrote 1565760K bytes to outer workfile.
 (seg0)   Initial batches 1..3:
 (seg0)     Read 45317K bytes from inner workfile: 15106K avg x 3 nonempty batches, 15139K max.
 (seg0)     Read 1565760K bytes from outer workfile: 521920K avg x 3 nonempty batches, 522027K max.
 (seg0)   Work file set: 3 files (0 compressed), max file size 15499264, min file size 32768, compression buffer size 0 bytes
 (seg0)   Hash chain length 3.4 avg, 14 max, using 504462 of 524288 buckets.
                                                         ->  Bitmap Heap Scan on lineitem  (cost=114032.17..1021364.88 rows=14851866 width=20) (actual time=4536.655..15322.914 rows=14812123 loops=1)
                                                               Recheck Cond: (l_returnflag = 'R'::bpchar)
                                                               Rows Removed by Index Recheck: 6906205
                                                               ->  Bitmap Index Scan on lineitem_l_orderkey_idx_l_returnflag  (cost=0.00..110319.21 rows=14851866 width=0) (actual time=4508.145..4508.145 rows=14812123 loops=1)
                                                         ->  Hash  (cost=96118.54..96118.54 rows=1605744 width=12) (actual time=809.374..809.374 rows=1718066 loops=1)
                                                               Buckets: 131072  Batches: 4  Memory Usage: 21137kB
                                                               ->  Broadcast Motion 3:3  (slice3; segments: 3)  (cost=151.60..96118.54 rows=1605744 width=12) (actual time=4.641..468.716 rows=1718066 loops=1)
                                                                     ->  Bitmap Heap Scan on orders  (cost=151.60..74708.62 rows=535248 width=12) (actual time=4.908..342.411 rows=572976 loops=1)
                                                                           Recheck Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                                                           Rows Removed by Index Recheck: 11502
                                                                           ->  Bitmap Index Scan on orders_o_orderdate_idx  (cost=0.00..17.78 rows=536402 width=0) (actual time=2.656..2.656 rows=25920 loops=1)
                                                                                 Index Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                 ->  Hash  (cost=1.42..1.42 rows=25 width=30) (actual time=0.023..0.024 rows=25 loops=1)
                                       Buckets: 65536  Batches: 1  Memory Usage: 514kB
                                       ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.00..1.42 rows=25 width=30) (actual time=0.007..0.013 rows=25 loops=1)
                                             ->  Seq Scan on nation  (cost=0.00..1.08 rows=8 width=30) (actual time=0.015..0.017 rows=10 loops=1)
 Optimizer: Postgres-based planner
 Planning Time: 6.785 ms
   (slice0)    Executor memory: 3255K bytes.
 * (slice1)    Executor memory: 61019K bytes avg x 3 workers, 61051K bytes max (seg2).  Work_mem: 44305K bytes max, 240657K bytes wanted.
 * (slice2)    Executor memory: 3170533K bytes avg x 3 workers, 3170629K bytes max (seg0).  Work_mem: 21137K bytes max, 81559K bytes wanted.
   (slice3)    Executor memory: 43681K bytes avg x 3 workers, 43852K bytes max (seg1).
   (slice4)    Executor memory: 38K bytes avg x 3 workers, 38K bytes max (seg0).
 Memory used:  128000kB
 Memory wanted:  1685892kB
 Execution Time: 38947.519 ms
(67 rows)

