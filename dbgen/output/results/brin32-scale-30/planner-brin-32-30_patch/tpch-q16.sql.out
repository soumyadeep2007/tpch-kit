                                                                                                  QUERY PLAN                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=162568.56..162568.87 rows=22 width=44) (actual time=18838.300..18862.726 rows=27840 loops=1)
   Merge Key: (count(DISTINCT partsupp.ps_suppkey)), part.p_brand, part.p_type, part.p_size
   ->  Sort  (cost=162568.56..162568.58 rows=7 width=44) (actual time=18836.855..18837.885 rows=9382 loops=1)
         Sort Key: (count(DISTINCT partsupp.ps_suppkey)) DESC, part.p_brand, part.p_type, part.p_size
         Sort Method:  quicksort  Memory: 3570kB
         Executor Memory: 2935kB  Segments: 3  Max: 985kB (segment 0)
         ->  GroupAggregate  (cost=162568.30..162568.46 rows=7 width=44) (actual time=17796.857..18819.324 rows=9382 loops=1)
               Group Key: part.p_brand, part.p_type, part.p_size
               ->  Sort  (cost=162568.30..162568.31 rows=7 width=40) (actual time=17796.745..18300.023 rows=1199737 loops=1)
                     Sort Key: part.p_brand, part.p_type, part.p_size
                     Sort Method:  external merge  Disk: 181408kB
                     Executor Memory: 127259kB  Segments: 3  Max: 42420kB (segment 0)
                     ->  Redistribute Motion 3:3  (slice2; segments: 3)  (cost=143396.56..162568.19 rows=7 width=40) (actual time=8070.818..15388.219 rows=1199737 loops=1)
                           Hash Key: part.p_brand, part.p_type, part.p_size
                           ->  Hash Join  (cost=143396.56..162568.05 rows=7 width=40) (actual time=8067.984..10587.054 rows=1187209 loops=1)
                                 Hash Cond: (part.p_partkey = partsupp.ps_partkey)
                                 Extra Text: (seg2)   Initial batch 0:
 (seg2)     Wrote 191332K bytes to inner workfile.
 (seg2)     Wrote 39036K bytes to outer workfile.
 (seg2)   Overflow batches 1..7:
 (seg2)     Read 240861K bytes from inner workfile: 34409K avg x 7 nonempty batches, 55658K max.
 (seg2)     Wrote 49529K bytes to inner workfile: 16510K avg x 3 overflowing batches, 28248K max.
 (seg2)     Read 39036K bytes from outer workfile: 5577K avg x 7 nonempty batches, 5619K max.
 (seg2)   Hash chain length 6.2 avg, 36 max, using 1290228 of 2097152 buckets.
                                 ->  Bitmap Heap Scan on part  (cost=89.09..18122.22 rows=303542 width=40) (actual time=3.740..238.736 rows=296961 loops=1)
                                       Recheck Cond: (p_size = ANY ('{3,45,14,32,41,8,21,15}'::integer[]))
                                       Rows Removed by Index Recheck: 45629
                                       Filter: ((p_brand <> 'Brand#55'::bpchar) AND ((p_type)::text !~~ 'LARGE ANODIZED%'::text))
                                       Rows Removed by Filter: 22986
                                       ->  Bitmap Index Scan on part_p_size_idx  (cost=0.00..13.20 rows=315125 width=0) (actual time=2.027..2.027 rows=19200 loops=1)
                                             Index Cond: (p_size = ANY ('{3,45,14,32,41,8,21,15}'::integer[]))
                                 ->  Hash  (cost=143307.37..143307.37 rows=8 width=8) (actual time=8063.046..8063.047 rows=8000358 loops=1)
                                       Buckets: 262144 (originally 131072)  Batches: 8 (originally 1)  Memory Usage: 41232kB
                                       ->  Redistribute Motion 3:3  (slice3; segments: 3)  (cost=9.88..143307.37 rows=8 width=8) (actual time=1.917..6183.226 rows=8000358 loops=1)
                                             Hash Key: partsupp.ps_partkey
                                             ->  Hash Left Anti Semi (Not-In) Join  (cost=9.88..143307.20 rows=8 width=8) (actual time=2.674..4801.865 rows=8000604 loops=1)
                                                   Hash Cond: (partsupp.ps_suppkey = supplier.s_suppkey)
                                                   Extra Text: (seg1)   Hash chain length 1.0 avg, 1 max, using 155 of 131072 buckets.
                                                   ->  Seq Scan on partsupp  (cost=0.00..123297.29 rows=7999129 width=8) (actual time=0.064..2149.730 rows=8004645 loops=1)
                                                   ->  Hash  (cost=9.51..9.51 rows=30 width=4) (actual time=2.131..2.131 rows=155 loops=1)
                                                         Buckets: 131072  Batches: 1  Memory Usage: 1030kB
                                                         ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.14..9.51 rows=30 width=4) (actual time=1.562..2.090 rows=155 loops=1)
                                                               ->  Index Only Scan using supplier_s_suppkey_idx_like on supplier  (cost=0.14..9.11 rows=10 width=4) (actual time=0.666..2.320 rows=60 loops=1)
                                                                     Heap Fetches: 60
 Optimizer: Postgres query optimizer
 Planning Time: 3.678 ms
   (slice0)    Executor memory: 126K bytes.
 * (slice1)    Executor memory: 43398K bytes avg x 3 workers, 43404K bytes max (seg0).  Work_mem: 42420K bytes max, 152255K bytes wanted.
 * (slice2)    Executor memory: 74108K bytes avg x 3 workers, 74343K bytes max (seg2).  Work_mem: 41232K bytes max, 314562K bytes wanted.
   (slice3)    Executor memory: 1088K bytes avg x 3 workers, 1088K bytes max (seg0).  Work_mem: 1030K bytes max.
   (slice4)    Executor memory: 113K bytes avg x 3 workers, 113K bytes max (seg0).
 Memory used:  128000kB
 Memory wanted:  1888271kB
 Execution Time: 18881.693 ms
(54 rows)

