                                                                                                            QUERY PLAN                                                                                                            
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=818811.16..818811.45 rows=20 width=201) (actual time=39135.088..39135.105 rows=20 loops=1)
   ->  Gather Motion 3:1  (slice1; segments: 3)  (cost=818811.16..818812.01 rows=60 width=201) (actual time=39135.086..39135.100 rows=20 loops=1)
         Merge Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount))))
         ->  Limit  (cost=818811.16..818811.21 rows=20 width=201) (actual time=39108.592..39131.031 rows=20 loops=1)
               ->  Sort  (cost=818739.63..819454.99 rows=286145 width=201) (actual time=39108.591..39108.596 rows=20 loops=1)
                     Sort Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount)))) DESC
                     Sort Method:  top-N heapsort  Memory: 101kB
                     Executor Memory: 177kB  Segments: 3  Max: 59kB (segment 0)
                     ->  HashAggregate  (cost=805732.23..811125.40 rows=286145 width=201) (actual time=36930.367..38876.074 rows=383465 loops=1)
                           Group Key: customer.c_custkey, customer.c_name, customer.c_acctbal, customer.c_phone, nation.n_name, customer.c_address, customer.c_comment
                           Planned Partitions: 4
                           Peak Memory Usage: 0 kB
                           ->  Hash Join  (cost=755065.17..791313.18 rows=286145 width=181) (actual time=32246.154..34997.515 rows=1146024 loops=1)
                                 Hash Cond: (customer.c_nationkey = nation.n_nationkey)
                                 Extra Text: (seg2)   Hash chain length 1.0 avg, 1 max, using 25 of 65536 buckets.
                                 ->  Hash Join  (cost=755063.44..787685.98 rows=286145 width=159) (actual time=32245.897..34580.487 rows=1146024 loops=1)
                                       Hash Cond: (customer.c_custkey = orders.o_custkey)
                                       Extra Text: (seg2)   Initial batch 0:
 (seg2)     Wrote 20929K bytes to inner workfile.
 (seg2)     Wrote 133257K bytes to outer workfile.
 (seg2)   Overflow batch 1:
 (seg2)     Read 20929K bytes from inner workfile.
 (seg2)     Read 133257K bytes from outer workfile.
 (seg2)   Hash chain length 5.7 avg, 41 max, using 201552 of 262144 buckets.
                                       ->  Seq Scan on customer  (cost=0.00..23888.00 rows=1500000 width=147) (actual time=0.146..342.820 rows=1501094 loops=1)
                                       ->  Hash  (cost=751486.62..751486.62 rows=286145 width=16) (actual time=32245.464..32245.465 rows=1146024 loops=1)
                                             Buckets: 131072 (originally 131072)  Batches: 2 (originally 1)  Memory Usage: 30852kB
                                             ->  Redistribute Motion 3:3  (slice2; segments: 3)  (cost=229405.43..751486.62 rows=286145 width=16) (actual time=11408.104..31979.879 rows=1146024 loops=1)
                                                   Hash Key: orders.o_custkey
                                                   ->  Hash Join  (cost=229405.43..745763.71 rows=286145 width=16) (actual time=11416.813..31765.453 rows=1145273 loops=1)
                                                         Hash Cond: (lineitem.l_orderkey = orders.o_orderkey)
                                                         Extra Text: (seg0)   Initial batch 0:
 (seg0)     Wrote 45317K bytes to inner workfile.
 (seg0)     Wrote 1565760K bytes to outer workfile.
 (seg0)   Initial batches 1..3:
 (seg0)     Read 45317K bytes from inner workfile: 15106K avg x 3 nonempty batches, 15139K max.
 (seg0)     Read 1565760K bytes from outer workfile: 521920K avg x 3 nonempty batches, 522027K max.
 (seg0)   Hash chain length 3.4 avg, 14 max, using 504462 of 524288 buckets.
                                                         ->  Bitmap Heap Scan on lineitem  (cost=113890.93..584852.37 rows=14781476 width=20) (actual time=1166.765..15645.954 rows=14812123 loops=1)
                                                               Recheck Cond: (l_returnflag = 'R'::bpchar)
                                                               Rows Removed by Index Recheck: 14704187
                                                               ->  Bitmap Index Scan on lineitem_l_orderkey_idx_l_returnflag  (cost=0.00..110195.56 rows=14781476 width=0) (actual time=1165.708..1165.708 rows=14812123 loops=1)
                                                         ->  Hash  (cost=95716.66..95716.66 rows=1583828 width=12) (actual time=874.438..874.439 rows=1718066 loops=1)
                                                               Buckets: 131072  Batches: 4  Memory Usage: 21137kB
                                                               ->  Broadcast Motion 3:3  (slice3; segments: 3)  (cost=149.75..95716.66 rows=1583828 width=12) (actual time=5.055..498.234 rows=1718066 loops=1)
                                                                     ->  Bitmap Heap Scan on orders  (cost=149.75..74598.95 rows=527943 width=12) (actual time=5.061..376.057 rows=572976 loops=1)
                                                                           Recheck Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                                                           Rows Removed by Index Recheck: 11490
                                                                           ->  Bitmap Index Scan on orders_o_orderdate_idx  (cost=0.00..17.76 rows=529147 width=0) (actual time=2.705..2.705 rows=25920 loops=1)
                                                                                 Index Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                 ->  Hash  (cost=1.42..1.42 rows=25 width=30) (actual time=0.027..0.027 rows=25 loops=1)
                                       Buckets: 65536  Batches: 1  Memory Usage: 514kB
                                       ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.00..1.42 rows=25 width=30) (actual time=0.007..0.015 rows=25 loops=1)
                                             ->  Seq Scan on nation  (cost=0.00..1.08 rows=8 width=30) (actual time=0.023..0.026 rows=10 loops=1)
 Optimizer: Postgres query optimizer
 Planning Time: 7.006 ms
   (slice0)    Executor memory: 3255K bytes.
 * (slice1)    Executor memory: 57680K bytes avg x 3 workers, 57712K bytes max (seg2).  Work_mem: 33969K bytes max, 56386K bytes wanted.
 * (slice2)    Executor memory: 2382357K bytes avg x 3 workers, 2382389K bytes max (seg1).  Work_mem: 21137K bytes max, 81559K bytes wanted.
   (slice3)    Executor memory: 43681K bytes avg x 3 workers, 43852K bytes max (seg1).
   (slice4)    Executor memory: 38K bytes avg x 3 workers, 38K bytes max (seg0).
 Memory used:  128000kB
 Memory wanted:  572208kB
 Execution Time: 39147.781 ms
(64 rows)

