                                                                                                   QUERY PLAN                                                                                                    
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=1424781.17..1424781.45 rows=20 width=201) (actual time=39851.341..39851.360 rows=20 loops=1)
   ->  Gather Motion 3:1  (slice1; segments: 3)  (cost=1424781.17..1424782.02 rows=60 width=201) (actual time=39851.339..39851.356 rows=20 loops=1)
         Merge Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount))))
         ->  Limit  (cost=1424781.17..1424781.22 rows=20 width=201) (actual time=39587.786..39607.994 rows=20 loops=1)
               ->  Sort  (cost=1424709.63..1425425.00 rows=286145 width=201) (actual time=39587.785..39587.789 rows=20 loops=1)
                     Sort Key: (sum((lineitem.l_extendedprice * ('1'::numeric - lineitem.l_discount)))) DESC
                     Sort Method:  top-N heapsort  Memory: 100kB
                     Executor Memory: 177kB  Segments: 3  Max: 59kB (segment 0)
                     ->  HashAggregate  (cost=1413518.59..1417095.40 rows=286145 width=201) (actual time=37532.704..39622.676 rows=383465 loops=1)
                           Group Key: customer.c_custkey, customer.c_name, customer.c_acctbal, customer.c_phone, nation.n_name, customer.c_address, customer.c_comment
                           Planned Partitions: 4
                           Peak Memory Usage: 0 kB
                           ->  Hash Join  (cost=1370116.94..1406364.95 rows=286145 width=181) (actual time=32733.522..35409.708 rows=1146024 loops=1)
                                 Hash Cond: (customer.c_nationkey = nation.n_nationkey)
                                 Extra Text: (seg2)   Hash chain length 1.0 avg, 1 max, using 25 of 131072 buckets.
                                 ->  Hash Join  (cost=1370115.21..1402737.76 rows=286145 width=159) (actual time=32733.175..34961.367 rows=1146024 loops=1)
                                       Hash Cond: (customer.c_custkey = orders.o_custkey)
                                       Extra Text: (seg2)   Initial batch 0:
 (seg2)     Wrote 20956K bytes to inner workfile.
 (seg2)     Wrote 133319K bytes to outer workfile.
 (seg2)   Overflow batch 1:
 (seg2)     Read 20956K bytes from inner workfile.
 (seg2)     Read 133319K bytes from outer workfile.
 (seg2)   Hash chain length 4.2 avg, 41 max, using 272306 of 524288 buckets.
                                       ->  Seq Scan on customer  (cost=0.00..23888.00 rows=1500000 width=147) (actual time=0.114..340.445 rows=1501094 loops=1)
                                       ->  Hash  (cost=1366538.39..1366538.39 rows=286145 width=16) (actual time=32732.740..32732.741 rows=1146024 loops=1)
                                             Buckets: 262144 (originally 131072)  Batches: 2 (originally 1)  Memory Usage: 40453kB
                                             ->  Redistribute Motion 3:3  (slice2; segments: 3)  (cost=279252.25..1366538.39 rows=286145 width=16) (actual time=8393.112..32441.422 rows=1146024 loops=1)
                                                   Hash Key: orders.o_custkey
                                                   ->  Hash Join  (cost=279252.25..1360815.49 rows=286145 width=16) (actual time=8011.239..32177.176 rows=1145273 loops=1)
                                                         Hash Cond: (lineitem.l_orderkey = orders.o_orderkey)
                                                         Extra Text: (seg0)   Initial batch 0:
 (seg0)     Wrote 30237K bytes to inner workfile.
 (seg0)     Wrote 1043734K bytes to outer workfile.
 (seg0)   Initial batch 1:
 (seg0)     Read 30237K bytes from inner workfile.
 (seg0)     Read 1043734K bytes from outer workfile.
 (seg0)   Hash chain length 3.4 avg, 14 max, using 504462 of 524288 buckets.
                                                         ->  Seq Scan on lineitem  (cost=0.00..1036166.40 rows=14781476 width=20) (actual time=0.109..17957.154 rows=14812123 loops=1)
                                                               Filter: (l_returnflag = 'R'::bpchar)
                                                               Rows Removed by Filter: 45191187
                                                         ->  Hash  (cost=259454.40..259454.40 rows=1583828 width=12) (actual time=924.477..924.477 rows=1718066 loops=1)
                                                               Buckets: 262144  Batches: 2  Memory Usage: 42267kB
                                                               ->  Broadcast Motion 3:3  (slice3; segments: 3)  (cost=149.75..259454.40 rows=1583828 width=12) (actual time=6.519..527.544 rows=1718066 loops=1)
                                                                     ->  Bitmap Heap Scan on orders  (cost=149.75..238336.70 rows=527943 width=12) (actual time=6.510..399.501 rows=572976 loops=1)
                                                                           Recheck Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                                                           Rows Removed by Index Recheck: 11490
                                                                           ->  Bitmap Index Scan on orders_o_orderdate_idx  (cost=0.00..17.76 rows=529147 width=0) (actual time=2.952..2.952 rows=25920 loops=1)
                                                                                 Index Cond: ((o_orderdate >= '1993-10-01'::date) AND (o_orderdate < '1994-01-01 00:00:00'::timestamp without time zone))
                                 ->  Hash  (cost=1.42..1.42 rows=25 width=30) (actual time=0.026..0.027 rows=25 loops=1)
                                       Buckets: 131072  Batches: 1  Memory Usage: 1026kB
                                       ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.00..1.42 rows=25 width=30) (actual time=0.007..0.015 rows=25 loops=1)
                                             ->  Seq Scan on nation  (cost=0.00..1.08 rows=8 width=30) (actual time=0.028..0.032 rows=10 loops=1)
 Optimizer: Postgres query optimizer
 Planning Time: 8.845 ms
   (slice0)    Executor memory: 3216K bytes.
 * (slice1)    Executor memory: 62433K bytes avg x 3 workers, 62487K bytes max (seg1).  Work_mem: 44209K bytes max, 57410K bytes wanted.
 * (slice2)    Executor memory: 42575K bytes avg x 3 workers, 42575K bytes max (seg0).  Work_mem: 42267K bytes max, 82583K bytes wanted.
   (slice3)    Executor memory: 43681K bytes avg x 3 workers, 43852K bytes max (seg1).
   (slice4)    Executor memory: 38K bytes avg x 3 workers, 38K bytes max (seg0).
 Memory used:  128000kB
 Memory wanted:  496794kB
 Execution Time: 39866.937 ms
(63 rows)

